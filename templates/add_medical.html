import io
import base64
import qrcode

# Inside POST request after inserting the medical
qr_data = f"{HOST_URL}/register/{medical_id}"

# Generate QR in memory
qr_img = qrcode.make(qr_data)
buf = io.BytesIO()
qr_img.save(buf, format='PNG')
buf.seek(0)

# Encode as base64 to store in MongoDB
qr_base64 = base64.b64encode(buf.getvalue()).decode('utf-8')

# Save base64 string in the medical document
mongo.db.medicals.update_one(
    {"_id": medical_id},
    {"$set": {"qr_code": qr_base64}}
)
